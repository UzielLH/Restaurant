<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Gerente - Restaurant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/gerente_styles.css') }}">
</head>
<body>
    <div class="gerente-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Panel Gerente</h2>
                <p class="gerente-name">{{ empleado.nombre }}</p>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-section="productos">
                    <span class="icon">üçΩÔ∏è</span>
                    Gesti√≥n de Platillos
                </a>
                <a href="#" class="nav-item" data-section="descuentos">
                    <span class="icon">üè∑Ô∏è</span>
                    Descuentos
                </a>
                <a href="#" class="nav-item" data-section="ordenes">
                    <span class="icon">üìã</span>
                    Generar √ìrdenes
                </a>
            </nav>
            <div class="sidebar-footer">
                <button class="btn-logout" onclick="cerrarSesionGerente()">Cerrar Sesi√≥n</button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Gesti√≥n de Platillos Section -->
            <section id="productos" class="content-section active">
                <div class="section-header">
                    <h1>Gesti√≥n de Platillos</h1>
                    <p>Edita informaci√≥n y costos de los productos</p>
                </div>

                <div class="filters-bar">
                    <div class="search-box">
                        <input type="text" id="buscar-producto" placeholder="Buscar platillo..." class="form-control">
                    </div>
                    <div class="filter-category">
                        <select id="filtro-categoria" class="form-control">
                            <option value="">Todas las categor√≠as</option>
                        </select>
                    </div>
                    <div class="filter-status">
                        <select id="filtro-status" class="form-control">
                            <option value="">Todos los estados</option>
                            <option value="disponible">Disponible</option>
                            <option value="fuera de servicio">Fuera de Servicio</option>
                        </select>
                    </div>
                </div>

                <div class="productos-grid" id="productos-grid">
                    <!-- Los productos se cargar√°n din√°micamente -->
                </div>

                <!-- Modal Editar Producto -->
                <div id="modal-editar-producto" class="modal">
                    <div class="modal-content large">
                        <span class="close" onclick="cerrarModalEditarProducto()">&times;</span>
                        <h2>Editar Platillo</h2>
                        <form id="form-editar-producto">
                            <input type="hidden" id="edit-producto-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nombre del Platillo *</label>
                                    <input type="text" id="edit-producto-nombre" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label>Categor√≠a *</label>
                                    <select id="edit-producto-categoria" class="form-control" required>
                                        <option value="">Seleccionar categor√≠a</option>
                                    </select>
                                </div>
                            </div>

                            <div class="pricing-calculator">
                                <h3 style="margin-bottom: 15px; color: #667eea;">üí∞ Calculadora de Precio</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Costo del Producto *</label>
                                        <input type="number" id="edit-producto-costo" class="form-control" 
                                            step="0.01" min="0" required 
                                            placeholder="Ej: 50.00">
                                        <small style="color: #666;">Costo de adquisici√≥n o producci√≥n</small>
                                    </div>
                                    <div class="form-group">
                                        <label>Ganancia Deseada *</label>
                                        <input type="number" id="edit-producto-ganancia" class="form-control" 
                                            step="0.01" min="0" value="0"
                                            placeholder="Ej: 20.00">
                                        <small style="color: #666;">Cu√°nto desea ganar por unidad</small>
                                    </div>
                                </div>

                                <div class="price-preview">
                                    <div class="preview-item">
                                        <span>Costo + IVA (16%):</span>
                                        <span id="edit-costo-iva-preview">Se calcular√° autom√°ticamente</span>
                                    </div>
                                    <div class="preview-item final">
                                        <span>Precio de Venta Final:</span>
                                        <span id="edit-precio-calculado-preview" style="font-size: 24px; font-weight: bold; color: #28a745;">$0.00</span>
                                    </div>
                                </div>

                                <div style="background: #e7f3ff; padding: 12px; border-radius: 8px; margin-top: 10px;">
                                    <small style="color: #0066cc;">
                                        ‚ÑπÔ∏è <strong>F√≥rmula:</strong> Precio Final = (Costo √ó 1.16) + Ganancia
                                    </small>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Precio en Puntos (Opcional)</label>
                                    <input type="number" id="edit-producto-puntos" class="form-control" 
                                        min="0" placeholder="Ej: 150">
                                    <small style="color: #666;">Puntos necesarios para canjear</small>
                                </div>
                                <div class="form-group">
                                    <label>URL de Imagen</label>
                                    <input type="url" id="edit-producto-img" class="form-control" 
                                        placeholder="https://ejemplo.com/imagen.jpg">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <textarea id="edit-producto-descripcion" class="form-control" rows="3"
                                        placeholder="Descripci√≥n del producto..."></textarea>
                            </div>

                            <div class="form-group">
                                <label>Estado del Producto</label>
                                <select id="edit-producto-status" class="form-control" required>
                                    <option value="disponible">Disponible</option>
                                    <option value="fuera de servicio">Fuera de Servicio</option>
                                </select>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="cerrarModalEditarProducto()">Cancelar</button>
                                <button type="submit" class="btn btn-primary">üíæ Guardar Cambios</button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Descuentos Section -->
            <section id="descuentos" class="content-section">
                <div class="section-header">
                    <h1>Gesti√≥n de Descuentos por Cliente</h1>
                    <button class="btn btn-primary" onclick="mostrarModalDescuentoGerente()">+ Nuevo Descuento</button>
                </div>

                <div class="table-container">
                    <table id="tabla-descuentos-gerente">
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Correo</th>
                                <th>Descuento</th>
                                <th>Fecha Inicio</th>
                                <th>Fecha Expiraci√≥n</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- Modal Crear Descuento (FUERA de la secci√≥n, al final antes del cierre de main) -->
            <div id="modal-descuento-gerente" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="cerrarModalDescuentoGerente()">&times;</span>
                    <h2 id="modal-descuento-titulo">Nuevo Descuento</h2>
                    <form id="form-descuento-gerente">
                        <div class="form-group">
                            <label>Cliente (Opcional)</label>
                            <select id="descuento-cliente-gerente" class="form-control">
                                <option value="">Descuento general (sin cliente espec√≠fico)</option>
                            </select>
                            <small style="color: #666;">Si no selecciona un cliente, el descuento ser√° general</small>
                        </div>
                        <div class="form-group">
                            <label>Porcentaje de Descuento * (0-100)</label>
                            <input type="number" id="descuento-porcentaje-gerente" class="form-control" 
                                min="0" max="100" step="0.01" required 
                                placeholder="Ej: 15.5">
                        </div>
                        <div class="form-group">
                            <label>Fecha de Expiraci√≥n (Opcional)</label>
                            <input type="date" id="descuento-fecha-fin-gerente" class="form-control">
                            <small style="color: #666;">Si no se especifica, el descuento no expirar√°</small>
                        </div>
                        <div class="form-group">
                            <label>Notas (Opcional)</label>
                            <textarea id="descuento-notas-gerente" class="form-control" rows="3" 
                                    placeholder="Motivo del descuento, condiciones, etc."></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="cerrarModalDescuentoGerente()">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Guardar Descuento</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Generar √ìrdenes Section -->
            <section id="ordenes" class="content-section">
                <div class="section-header">
                    <h1>Generar √ìrdenes</h1>
                    <p>Crea √≥rdenes directamente desde el panel de gerente</p>
                </div>

                <div class="orden-container">
                    <div class="productos-selection">
                        <h3>Seleccionar Productos</h3>
                        
                        <div class="categoria-tabs" id="categoria-tabs">
                            <!-- Las categor√≠as se cargar√°n din√°micamente -->
                        </div>

                        <div class="productos-list" id="productos-orden-list">
                            <!-- Los productos se cargar√°n din√°micamente -->
                        </div>
                    </div>

                    <div class="orden-resumen">
                        <h3>Resumen de Orden</h3>
                        
                        <div class="cliente-selector">
                            <label>Cliente (Opcional)</label>
                            <div class="input-group">
                                <input type="text" id="orden-cliente-correo" class="form-control" placeholder="correo@ejemplo.com">
                                <button class="btn btn-secondary" onclick="buscarClienteOrden()">Buscar</button>
                            </div>
                            <div id="cliente-info-orden"></div>
                        </div>

                        <div class="items-list" id="orden-items-list">
                            <p class="empty-message">No hay productos en la orden</p>
                        </div>

                        <div class="orden-totales">
                            <div class="total-row">
                                <span>Subtotal:</span>
                                <span id="orden-subtotal">$0.00</span>
                            </div>
                            <div class="total-row total-final">
                                <span>Total:</span>
                                <span id="orden-total">$0.00</span>
                            </div>
                        </div>

                        <div class="orden-notas">
                            <label>Notas Especiales</label>
                            <textarea id="orden-notas" class="form-control" rows="2" placeholder="Instrucciones especiales..."></textarea>
                        </div>

                        <div class="orden-actions">
                            <button class="btn btn-secondary btn-block" onclick="limpiarOrden()">Limpiar Orden</button>
                            <button class="btn btn-primary btn-block" onclick="guardarOrdenGerente()">Generar Orden</button>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script src="{{ url_for('static', filename='js/gerente_dashboard.js') }}"></script>
</body>
</html>